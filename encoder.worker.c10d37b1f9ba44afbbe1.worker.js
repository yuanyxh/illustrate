!function(){"use strict";var t=[71,73,70,56,57,97],e=[33,255],r=[33,1],i=[33,254],o=[33,249],n=[44],l=[59],a=4096;function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function s(t){var e=function(t,e){if("object"!==h(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,e||"default");if("object"!==h(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===h(e)?e:String(e)}function u(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function c(t,e,r){return e&&u(t.prototype,e),r&&u(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var v=c((function t(){f(this,t),this.children=void 0,this.isEndOfWord=void 0,this.code=void 0,this.children=new Array(4096),this.isEndOfWord=!1})),d=function(){function t(){f(this,t),this.root=new v,this.count=0}return c(t,[{key:"insert",value:function(t){for(var e=this.root,r=0;r<t.length;r++){var i=t[r];e.children[i]||(e.children[i]=new v),e=e.children[i]}e.isEndOfWord=!0,e.code=this.count,this.count++}},{key:"search",value:function(t){for(var e=this.root,r=0;r<t.length;r++){var i=t[r];if(!e.children[i])return!1;e=e.children[i]}return e}},{key:"clear",value:function(){this.root=new v,this.count=0}}]),t}(),y=function(){function h(){f(this,h),this.pages=void 0,this.cursor=0,this.pages=[],this.newPage()}return c(h,[{key:"newPage",value:function(){this.pages[this.pages.length]=new Uint8Array(a),this.cursor=0}},{key:"writeByte",value:function(t){this.pages[this.pages.length-1][this.cursor++]=t,this.cursor===a&&this.newPage()}},{key:"writeBytes",value:function(t){for(var e=0;e<t.length;e++)this.writeByte(t[e])}},{key:"writeShort",value:function(t){var e=[255&t,t>>8&255];this.writeBytes(e)}},{key:"writeGifMagic",value:function(){this.writeBytes(t)}},{key:"writeLogicalScreenDescriptor",value:function(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.writeShort(t),this.writeShort(e),this.writeBytes([r,i,o])}},{key:"writeApplicationExtension",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.writeBytes(e),this.writeByte(11),this.writeBytes(Array.from((new TextEncoder).encode("NETSCAPE2.0"))),this.writeByte(3),this.writeByte(1),this.writeShort(t),this.writeByte(0)}},{key:"writeGraphicControlExtension",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:40,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.writeBytes(o),this.writeByte(4),this.writeByte(t),this.writeShort(e),this.writeByte(r),this.writeByte(0)}},{key:"writePlainTextExtension",value:function(){this.writeBytes(r)}},{key:"writeCommentExtension",value:function(){this.writeBytes(i)}},{key:"writeImageDescriptor",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.writeBytes(n),this.writeShort(i),this.writeShort(o),this.writeShort(t),this.writeShort(e),this.writeByte(r)}},{key:"export",value:function(){var t=0,e=this.pages.length,r=this.cursor;t=0===r?e*a:e>0?(e-1)*a+r:0;for(var i=new Uint8Array(t),o=0;o<e;o++){var n=this.pages[o];if(r&&o===e-1){var l=n.slice(0,r);i.set(l,o*a);break}i.set(n,o*a)}return i}},{key:"end",value:function(){return this.writeBytes(l),this.export()}}]),h}(),w=y;function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function g(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"===typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var m=c((function t(){f(this,t),this.children=[],this.color=void 0,this.pixelCount=0,this.color=null})),b=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(f(this,t),this.maxDepth=8,this.count=1,this.root=void 0,e>8)throw new Error("the maximum depth cannot exceed 8");this.maxDepth=e,this.root=new m}return c(t,[{key:"insertColor",value:function(t){var e=this.root;e.pixelCount++;for(var r=this.maxDepth-1;r>=0;r--){var i=this.getColorIndex(t,r);e.children[i]||(e.children[i]=new m),(e=e.children[i]).pixelCount++}if(null===e.color)return this.count++,e.color=t;for(var o=["r","g","b"],n=0;n<o.length;n++)e.color[o[n]]+=t[o[n]]}},{key:"getColorIndex",value:function(t,e){var r=0,i=1<<e;return t.r&i&&(r|=1),t.g&i&&(r|=2),t.b&i&&(r|=4),r}},{key:"shrink",value:function(t){if(this.count<=t)return[];for(var e=this.maxDepth-1;e>=0&&(this.reduceColor(this.root,e,0,t),!(this.count<=t));e--);return this.collectColor()}},{key:"reduceColor",value:function(t,e,r,i){if(!(this.count<=i)){var o=g(t.children);if(e===r)this._reduceColor(t,i);else if(e>r)for(var n=0;n<o.length;n++)null!==o[n]&&void 0!==o[n]&&this.reduceColor(o[n],e,r+1,i)}}},{key:"_reduceColor",value:function(t,e){var r=!0,i=g(t.children);i.sort((function(t,e){return t.pixelCount-e.pixelCount}));for(var o=0;o<i.length;o++)if(null!==i[o]&&void 0!==i[o]){var n=i[o].color;if(null!==n)if(null!==t.color){for(var l=["r","g","b"],a=0;a<l.length;a++)t.color[l[a]]+=n[l[a]];if(this.count--,this.count<=e){r=!1;for(var h=0;h<o;h++){var s=t.children.indexOf(i[h]);t.children.splice(s,1,null)}break}}else t.color=n}r&&(t.children=[])}},{key:"quantizeColor",value:function(t){for(var e=this.root,r=this.maxDepth-1;r>=0;r--){var i=this.getColorIndex(t,r);if(!e.children[i])break;e=e.children[i]}return e.color}},{key:"collectColor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.root;if(null===t||void 0===t)return[];for(var e=[],r=t.children,i=0;i<r.length;i++)if(null!==r[i]&&void 0!==r[i]){var o=r[i].color;if(o){if(!o.normalize){var n=o.r,l=o.g,a=o.b;o.r=Math.round(n/r[i].pixelCount)||0,o.g=Math.round(l/r[i].pixelCount)||0,o.b=Math.round(a/r[i].pixelCount)||0,o.normalize=!0}e.push(o)}e.push.apply(e,g(this.collectColor(r[i])))}return e}},{key:"calcColorDistance",value:function(t,e){var r=Math.sqrt(Math.pow(t.r-e.r,2)+Math.pow(t.g-e.g,2)+Math.pow(t.b-e.b,2));return Math.floor(100*(1-r/Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2))))}}]),t}(),x=b;var k=function(t){for(var e=new x,r=0;r<t.length;r+=4)e.insertColor({r:t[r],g:t[r+1],b:t[r+2]});return e.shrink(256),{colorList:e.collectColor(),octree:e}},C=self;C.addEventListener("message",(function(t){for(var e=t.data,r=e.data.data,i=e.options,o=i.offsetLeft,n=void 0===o?0:o,l=i.offsetTop,a=void 0===l?0:l,h=i.width,s=void 0===h?0:h,u=i.height,c=void 0===u?0:u,f=i.disposalMethod,v=void 0===f?4:f,y=i.userInput,p=void 0===y?0:y,g=i.transparency,m=void 0===g?0:g,b=i.delay,x=void 0===b?40:b,B=i.transparencyIndex,S=void 0===B?0:B,E=new Map,M=[],A=k(r),I=A.colorList,D=A.octree,O=0;O<r.length;O+=4){var P=D.quantizeColor({r:r[O],g:r[O+1],b:r[O+2]});if(!P)throw Error("the color disk compilation fails, and there is a problem with the quantification of the color");if(E.has(P))M.push(E.get(P)||0);else{var j=I.indexOf(P);if(E.set(P,j),M.push(j),j<0||j>255)throw Error("the color disk compilation fails, exceeding the expected value")}}if(M.length!==s*c)throw Error("index length error");for(var T=I.map((function(t){return[t.r,t.g,t.b]})),q=2;T.length>1<<q;)q++;for(var L=0,z=T.length;L<(1<<q)-z;L++)T.push([0,0,0]);var G=1<<q,U=G+1,W=new d,N=new w;N.writeGraphicControlExtension(v|p|m,x/10,S),N.writeImageDescriptor(s,c,128|q-1,n,a),N.writeBytes(T.flat()),N.writeByte(q);var _=q+1,$=[],F=[],H=M.length,J=0,K=0,Q=0,R=[],V=function(t){for(t<<=Q,t|=K,Q+=_;Q>=8;)R[R.length]=255&t,255===R.length&&(N.writeByte(255),N.writeBytes(R),R.length=0),t>>>=8,Q-=8;K=t};V(G),$=[M[J++]];for(var X=0;X<=U;X++)W.insert([X]);for(;J<H;){F=[M[J++]];var Y=$.concat(F);if(W.search(Y))$=Y,F=[];else{W.insert(Y);var Z=W.search($);Z&&V(Z.code),$=F,F=[];var tt=W.count-1;if(tt>(1<<_)-1&&_<12)_++;else if(4096===tt){W.clear();for(var et=0;et<=U;et++)W.insert([et]);V(G),_=q+1}}}var rt=W.search($);rt&&V(rt.code),V(U),0!==Q&&(R[R.length]=K),R.length&&(N.writeByte(R.length),N.writeBytes(R)),N.writeByte(0);var it=N.export();C.postMessage({index:i.index,data:it})}))}();
//# sourceMappingURL=encoder.worker.c10d37b1f9ba44afbbe1.worker.js.map